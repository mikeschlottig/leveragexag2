<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Add distributed tracing and observability to AG2 multi-agent workflows using OpenTelemetry."><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/user-guide/tracing/opentelemetry/ rel=canonical><link href=../../observability/logging_events/ rel=prev><link href=../remote-agents/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.19"><title>OpenTelemetry Tracing - AG2</title><link rel=stylesheet href=../../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../css/timeago.css><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - OpenTelemetry Tracing"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/user-guide/tracing/opentelemetry/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - OpenTelemetry Tracing"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installation class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OpenTelemetry Tracing </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class=md-tabs__item> <a href=../../../use-cases/use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> Installing AG2 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../basic-concepts/overview/ class=md-nav__link> <span class=md-ellipsis> Basic Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../advanced-concepts/llm-configuration-deep-dive/ class=md-nav__link> <span class=md-ellipsis> Advanced Concepts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../models/amazon-bedrock/ class=md-nav__link> <span class=md-ellipsis> Model Providers </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference-agents/ class=md-nav__link> <span class=md-ellipsis> Reference Agents </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference-tools/ class=md-nav__link> <span class=md-ellipsis> Reference Tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../a2a/ class=md-nav__link> <span class=md-ellipsis> A2A </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../ag-ui/ class=md-nav__link> <span class=md-ellipsis> AG-UI </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9 checked> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex=0> <span class=md-ellipsis> Observability </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=true> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../observability/logging_events/ class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> OpenTelemetry Tracing </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> OpenTelemetry Tracing </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=#instrumentation-api class=md-nav__link> <span class=md-ellipsis> Instrumentation API </span> </a> <nav class=md-nav aria-label="Instrumentation API"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#instrument_agent class=md-nav__link> <span class=md-ellipsis> instrument_agent </span> </a> </li> <li class=md-nav__item> <a href=#instrument_llm_wrapper class=md-nav__link> <span class=md-ellipsis> instrument_llm_wrapper </span> </a> </li> <li class=md-nav__item> <a href=#instrument_pattern class=md-nav__link> <span class=md-ellipsis> instrument_pattern </span> </a> </li> <li class=md-nav__item> <a href=#instrument_a2a_server class=md-nav__link> <span class=md-ellipsis> instrument_a2a_server </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#trace-hierarchy class=md-nav__link> <span class=md-ellipsis> Trace Hierarchy </span> </a> </li> <li class=md-nav__item> <a href=#span-types class=md-nav__link> <span class=md-ellipsis> Span Types </span> </a> </li> <li class=md-nav__item> <a href=#semantic-attributes class=md-nav__link> <span class=md-ellipsis> Semantic Attributes </span> </a> <nav class=md-nav aria-label="Semantic Attributes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#standard-opentelemetry-genai-attributes class=md-nav__link> <span class=md-ellipsis> Standard OpenTelemetry GenAI Attributes </span> </a> </li> <li class=md-nav__item> <a href=#ag2-specific-attributes class=md-nav__link> <span class=md-ellipsis> AG2-Specific Attributes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backend-integration class=md-nav__link> <span class=md-ellipsis> Backend Integration </span> </a> <nav class=md-nav aria-label="Backend Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#grafana-tempo class=md-nav__link> <span class=md-ellipsis> Grafana Tempo </span> </a> </li> <li class=md-nav__item> <a href=#jaeger class=md-nav__link> <span class=md-ellipsis> Jaeger </span> </a> </li> <li class=md-nav__item> <a href=#commercial-backends class=md-nav__link> <span class=md-ellipsis> Commercial Backends </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-development-stack class=md-nav__link> <span class=md-ellipsis> Local Development Stack </span> </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> <nav class=md-nav aria-label=Examples> <ul class=md-nav__list> <li class=md-nav__item> <a href=#two-agent-chat class=md-nav__link> <span class=md-ellipsis> Two-Agent Chat </span> </a> </li> <li class=md-nav__item> <a href=#tool-execution class=md-nav__link> <span class=md-ellipsis> Tool Execution </span> </a> </li> <li class=md-nav__item> <a href=#group-chat-with-pattern class=md-nav__link> <span class=md-ellipsis> Group Chat with Pattern </span> </a> </li> <li class=md-nav__item> <a href=#distributed-tracing-with-a2a class=md-nav__link> <span class=md-ellipsis> Distributed Tracing with A2A </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#message-and-data-capture class=md-nav__link> <span class=md-ellipsis> Message and Data Capture </span> </a> <nav class=md-nav aria-label="Message and Data Capture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enabling-llm-message-capture class=md-nav__link> <span class=md-ellipsis> Enabling LLM Message Capture </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../remote-agents/ class=md-nav__link> <span class=md-ellipsis> Tracing Remote Agents </span> </a> </li> <li class=md-nav__item> <a href=../local-setup/ class=md-nav__link> <span class=md-ellipsis> Local Setup </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../deployments/deploy-an-agent-to-vertexai/ class=md-nav__link> <span class=md-ellipsis> Deployments </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../FAQ/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../use-cases/use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=#quick-start class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=#instrumentation-api class=md-nav__link> <span class=md-ellipsis> Instrumentation API </span> </a> <nav class=md-nav aria-label="Instrumentation API"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#instrument_agent class=md-nav__link> <span class=md-ellipsis> instrument_agent </span> </a> </li> <li class=md-nav__item> <a href=#instrument_llm_wrapper class=md-nav__link> <span class=md-ellipsis> instrument_llm_wrapper </span> </a> </li> <li class=md-nav__item> <a href=#instrument_pattern class=md-nav__link> <span class=md-ellipsis> instrument_pattern </span> </a> </li> <li class=md-nav__item> <a href=#instrument_a2a_server class=md-nav__link> <span class=md-ellipsis> instrument_a2a_server </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#trace-hierarchy class=md-nav__link> <span class=md-ellipsis> Trace Hierarchy </span> </a> </li> <li class=md-nav__item> <a href=#span-types class=md-nav__link> <span class=md-ellipsis> Span Types </span> </a> </li> <li class=md-nav__item> <a href=#semantic-attributes class=md-nav__link> <span class=md-ellipsis> Semantic Attributes </span> </a> <nav class=md-nav aria-label="Semantic Attributes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#standard-opentelemetry-genai-attributes class=md-nav__link> <span class=md-ellipsis> Standard OpenTelemetry GenAI Attributes </span> </a> </li> <li class=md-nav__item> <a href=#ag2-specific-attributes class=md-nav__link> <span class=md-ellipsis> AG2-Specific Attributes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backend-integration class=md-nav__link> <span class=md-ellipsis> Backend Integration </span> </a> <nav class=md-nav aria-label="Backend Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#grafana-tempo class=md-nav__link> <span class=md-ellipsis> Grafana Tempo </span> </a> </li> <li class=md-nav__item> <a href=#jaeger class=md-nav__link> <span class=md-ellipsis> Jaeger </span> </a> </li> <li class=md-nav__item> <a href=#commercial-backends class=md-nav__link> <span class=md-ellipsis> Commercial Backends </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#local-development-stack class=md-nav__link> <span class=md-ellipsis> Local Development Stack </span> </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> <nav class=md-nav aria-label=Examples> <ul class=md-nav__list> <li class=md-nav__item> <a href=#two-agent-chat class=md-nav__link> <span class=md-ellipsis> Two-Agent Chat </span> </a> </li> <li class=md-nav__item> <a href=#tool-execution class=md-nav__link> <span class=md-ellipsis> Tool Execution </span> </a> </li> <li class=md-nav__item> <a href=#group-chat-with-pattern class=md-nav__link> <span class=md-ellipsis> Group Chat with Pattern </span> </a> </li> <li class=md-nav__item> <a href=#distributed-tracing-with-a2a class=md-nav__link> <span class=md-ellipsis> Distributed Tracing with A2A </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#message-and-data-capture class=md-nav__link> <span class=md-ellipsis> Message and Data Capture </span> </a> <nav class=md-nav aria-label="Message and Data Capture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enabling-llm-message-capture class=md-nav__link> <span class=md-ellipsis> Enabling LLM Message Capture </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/user-guide/tracing/opentelemetry.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"></path></svg> </a> <h1>OpenTelemetry Tracing</h1> <p>AG2 provides built-in <a href=https://opentelemetry.io/ classname=external-link target=_blank rel="noopener noreferrer">OpenTelemetry</a> instrumentation for multi-agent workflows. The tracing module follows the <a href=https://opentelemetry.io/docs/specs/semconv/gen-ai/gen-ai-agent-spans/ classname=external-link target=_blank rel="noopener noreferrer">OpenTelemetry GenAI Semantic Conventions</a> for agent spans, giving you structured observability into conversations, LLM calls, tool executions, code execution, and human-in-the-loop interactions.</p> <p>Because AG2 uses standard OpenTelemetry, traces can be exported to <strong>any compatible backend</strong> -- Jaeger, Grafana Tempo, Datadog, Honeycomb, Axiom, and many others.</p> <h2 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">#</a></h2> <p>Install AG2 with the <code>tracing</code> extra to pull in the required OpenTelemetry SDK and exporter packages:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pip<span class=w> </span>install<span class=w> </span><span class=s2>"ag2[tracing]"</span>
</code></pre></div> <p>This installs <code>opentelemetry-api</code>, <code>opentelemetry-sdk</code>, and the OTLP gRPC exporter.</p> <h2 id=quick-start>Quick Start<a class=headerlink href=#quick-start title="Permanent link">#</a></h2> <p>The following example sets up tracing with a <code>ConsoleSpanExporter</code> so you can see spans printed directly to your terminal. In production you would replace this with an OTLP exporter pointed at your backend.</p> <div class=highlight><span class=filename>quickstart_tracing.py</span><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>trace</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.resources</span><span class=w> </span><span class=kn>import</span> <span class=n>Resource</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace</span><span class=w> </span><span class=kn>import</span> <span class=n>TracerProvider</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace.export</span><span class=w> </span><span class=kn>import</span> <span class=n>SimpleSpanProcessor</span><span class=p>,</span> <span class=n>ConsoleSpanExporter</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_agent</span><span class=p>,</span> <span class=n>instrument_llm_wrapper</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1># 1. Configure the TracerProvider</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span><span class=s2>"service.name"</span><span class=p>:</span> <span class=s2>"ag2-quickstart"</span><span class=p>})</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=n>tracer_provider</span> <span class=o>=</span> <span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>)</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=n>tracer_provider</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span><span class=n>SimpleSpanProcessor</span><span class=p>(</span><span class=n>ConsoleSpanExporter</span><span class=p>()))</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=c1># 2. Create agents</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=n>assistant</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"assistant"</span><span class=p>,</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You are a helpful assistant."</span><span class=p>,</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=p>)</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=n>user_proxy</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"user_proxy"</span><span class=p>,</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>    <span class=n>max_consecutive_auto_reply</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=p>)</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=c1># 3. Instrument agents and LLM calls</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>assistant</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>user_proxy</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=c1># 4. Run a chat</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=n>result</span> <span class=o>=</span> <span class=n>user_proxy</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>    <span class=n>assistant</span><span class=p>,</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"What is the capital of France?"</span><span class=p>,</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=p>)</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>When you run this script, the <code>ConsoleSpanExporter</code> prints each span to stdout as it completes. You will see a <code>conversation</code> span wrapping the entire chat, <code>invoke_agent</code> spans for each <code>generate_reply</code> call, and <code>chat</code> spans for each LLM API request -- all connected by a shared trace ID.</p> <h2 id=instrumentation-api>Instrumentation API<a class=headerlink href=#instrumentation-api title="Permanent link">#</a></h2> <p>AG2 exposes four instrumentation functions in <code>autogen.opentelemetry</code>. Each one takes a <code>tracer_provider</code> keyword argument and patches the target object in place.</p> <h3 id=instrument_agent><code>instrument_agent</code><a class=headerlink href=#instrument_agent title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_agent</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <p>Instruments a single <code>ConversableAgent</code> (or any subclass) to emit spans for:</p> <table> <thead> <tr> <th>Activity</th> <th>Span name pattern</th> <th>When it fires</th> </tr> </thead> <tbody> <tr> <td>Conversations</td> <td><code>conversation {agent.name}</code></td> <td><code>run</code> / <code>initiate_chat</code> / <code>a_initiate_chat</code> / <code>resume</code></td> </tr> <tr> <td>Agent invocations</td> <td><code>invoke_agent {agent.name}</code></td> <td><code>generate_reply</code> / <code>a_generate_reply</code></td> </tr> <tr> <td>Remote agent calls</td> <td><code>invoke_agent {agent.name}</code></td> <td><code>a_generate_remote_reply</code> (A2A)</td> </tr> <tr> <td>Tool execution</td> <td><code>execute_tool {func_name}</code></td> <td><code>execute_function</code> / <code>a_execute_function</code></td> </tr> <tr> <td>Code execution</td> <td><code>execute_code {agent.name}</code></td> <td>Code-execution reply handler</td> </tr> <tr> <td>Human input</td> <td><code>await_human_input {agent.name}</code></td> <td><code>get_human_input</code> / <code>a_get_human_input</code></td> </tr> <tr> <td>Sequential / parallel chats</td> <td><code>agent.initiate_chats</code></td> <td><code>initiate_chats</code> / <code>a_initiate_chats</code></td> </tr> </tbody> </table> <p>The function returns the same agent object (modified in place), so you can chain it if you like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>agent</span> <span class=o>=</span> <span class=n>instrument_agent</span><span class=p>(</span><span class=n>ConversableAgent</span><span class=p>(</span><span class=o>...</span><span class=p>),</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <h3 id=instrument_llm_wrapper><code>instrument_llm_wrapper</code><a class=headerlink href=#instrument_llm_wrapper title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_llm_wrapper</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <p>Instruments <strong>all</strong> LLM calls globally by patching <code>OpenAIWrapper.create()</code>. Each call produces a <code>chat {model}</code> span that captures:</p> <ul> <li>Provider name (<code>openai</code>, <code>anthropic</code>, <code>azure.ai.openai</code>, etc.)</li> <li>Model name</li> <li>Token usage (input and output)</li> <li>Request parameters (temperature, max_tokens, etc.)</li> <li>Response metadata (finish reasons, cost)</li> </ul> <p>LLM spans automatically become children of the active <code>invoke_agent</code> span through OpenTelemetry's context propagation.</p> <p><strong>Message capture</strong> -- By default, request and response messages are <strong>not</strong> captured because they may contain sensitive data. To enable message capture for debugging, pass <code>capture_messages=True</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>,</span> <span class=n>capture_messages</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <p>See the <a href=#message-and-data-capture>Message and Data Capture</a> section for details.</p> <h3 id=instrument_pattern><code>instrument_pattern</code><a class=headerlink href=#instrument_pattern title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_pattern</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>instrument_pattern</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <p>Instruments a group chat <code>Pattern</code> (such as <code>AutoPattern</code>, <code>RoundRobinPattern</code>, etc.). This is the recommended approach for group chats because it automatically:</p> <ul> <li>Instruments <strong>all agents</strong> in the pattern</li> <li>Instruments the <code>GroupChatManager</code></li> <li>Wraps speaker selection to produce <code>speaker_selection</code> spans with candidate and selected-agent attributes</li> </ul> <div class=highlight><span class=filename>group_chat_tracing.py</span><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>run_group_chat</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_llm_wrapper</span><span class=p>,</span> <span class=n>instrument_pattern</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=n>researcher</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"researcher"</span><span class=p>,</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You research topics and provide factual information. Be concise."</span><span class=p>,</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=p>)</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=n>writer</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"writer"</span><span class=p>,</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You take research and write clear summaries. Say TERMINATE when done."</span><span class=p>,</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=p>)</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=n>user</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>"user"</span><span class=p>,</span> <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>researcher</span><span class=p>,</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>researcher</span><span class=p>,</span> <span class=n>writer</span><span class=p>],</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>    <span class=n>group_manager_args</span><span class=o>=</span><span class=p>{</span><span class=s2>"llm_config"</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=p>)</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a><span class=c1># Instrument everything at once</span>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=n>instrument_pattern</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=n>result</span> <span class=o>=</span> <span class=n>run_group_chat</span><span class=p>(</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>    <span class=n>messages</span><span class=o>=</span><span class=s2>"What are the three laws of thermodynamics? Summarize briefly."</span><span class=p>,</span>
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>    <span class=n>max_rounds</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a><span class=p>)</span>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <h3 id=instrument_a2a_server><code>instrument_a2a_server</code><a class=headerlink href=#instrument_a2a_server title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_a2a_server</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>instrument_a2a_server</span><span class=p>(</span><span class=n>server</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <p>Instruments an <code>A2aAgentServer</code> for distributed tracing across services. This function:</p> <ul> <li>Adds ASGI middleware that extracts <a href=https://www.w3.org/TR/trace-context/ classname=external-link target=_blank rel="noopener noreferrer">W3C Trace Context</a> headers from incoming HTTP requests</li> <li>Instruments the server's underlying agent (calls <code>instrument_agent</code> internally)</li> </ul> <p>When a client sends a request with a <code>traceparent</code> header, the server-side spans are linked to the client's trace, giving you a single end-to-end trace across services.</p> <div class=highlight><span class=filename>a2a_server_traced.py</span><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.a2a</span><span class=w> </span><span class=kn>import</span> <span class=n>A2aAgentServer</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_a2a_server</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"tech_agent"</span><span class=p>,</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You solve technical problems."</span><span class=p>,</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=p>)</span>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=n>server</span> <span class=o>=</span> <span class=n>A2aAgentServer</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>url</span><span class=o>=</span><span class=s2>"http://localhost:18123/"</span><span class=p>)</span>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=n>server</span> <span class=o>=</span> <span class=n>instrument_a2a_server</span><span class=p>(</span><span class=n>server</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=n>app</span> <span class=o>=</span> <span class=n>server</span><span class=o>.</span><span class=n>build</span><span class=p>()</span>
</code></pre></div> <p>On the client side, <code>instrument_agent</code> automatically injects <code>traceparent</code> headers into outgoing HTTP calls for <code>A2aRemoteAgent</code>, so no additional setup is needed on the client.</p> <h2 id=trace-hierarchy>Trace Hierarchy<a class=headerlink href=#trace-hierarchy title="Permanent link">#</a></h2> <p>AG2 traces form a hierarchical tree that mirrors how agents process a conversation. Here is the typical structure for a two-agent chat:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>conversation user_proxy                   # run
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>  |-- invoke_agent assistant              # generate_reply
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>  |     |-- chat gpt-4o-mini              # LLM API call
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>  |-- invoke_agent user_proxy             # generate_reply
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>  |-- invoke_agent assistant              # generate_reply
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>  |     |-- chat gpt-4o-mini              # LLM API call
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>  |     +-- execute_tool get_weather      # tool execution
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>  |-- invoke_agent assistant              # generate_reply
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>  |     +-- chat gpt-4o-mini              # LLM API call
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>  +-- invoke_agent user_proxy             # generate_reply
</code></pre></div> <p>For group chats with a pattern, the tree includes speaker selection:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>conversation chat_manager                 # run_chat (GroupChatManager)
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>  |-- speaker_selection                   # auto speaker selection
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>  |     +-- invoke_agent speaker_sel...   # internal LLM call to pick speaker
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>  |           +-- chat gpt-4o-mini
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>  |-- invoke_agent researcher             # selected agent generates reply
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>  |     +-- chat gpt-4o-mini
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>  |-- speaker_selection
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>  |     +-- invoke_agent speaker_sel...
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>  |           +-- chat gpt-4o-mini
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>  +-- invoke_agent writer
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>        +-- chat gpt-4o-mini
</code></pre></div> <h2 id=span-types>Span Types<a class=headerlink href=#span-types title="Permanent link">#</a></h2> <p>Every span emitted by AG2 includes an <code>ag2.span.type</code> attribute that identifies what the span represents:</p> <table> <thead> <tr> <th><code>ag2.span.type</code></th> <th>Operation name</th> <th>Triggered by</th> </tr> </thead> <tbody> <tr> <td><code>conversation</code></td> <td><code>conversation</code></td> <td><code>run</code>, <code>initiate_chat</code>, <code>a_initiate_chat</code>, <code>resume</code>, <code>run_chat</code>, <code>a_run_chat</code></td> </tr> <tr> <td><code>multi_conversation</code></td> <td><code>initiate_chats</code></td> <td><code>initiate_chats</code>, <code>a_initiate_chats</code> (sequential or parallel)</td> </tr> <tr> <td><code>agent</code></td> <td><code>invoke_agent</code></td> <td><code>generate_reply</code>, <code>a_generate_reply</code>, <code>a_generate_remote_reply</code></td> </tr> <tr> <td><code>llm</code></td> <td><code>chat</code></td> <td><code>OpenAIWrapper.create()</code> (every LLM API call)</td> </tr> <tr> <td><code>tool</code></td> <td><code>execute_tool</code></td> <td><code>execute_function</code>, <code>a_execute_function</code></td> </tr> <tr> <td><code>code_execution</code></td> <td><code>execute_code</code></td> <td>Code-execution reply handler</td> </tr> <tr> <td><code>human_input</code></td> <td><code>await_human_input</code></td> <td><code>get_human_input</code>, <code>a_get_human_input</code></td> </tr> <tr> <td><code>speaker_selection</code></td> <td><code>speaker_selection</code></td> <td><code>_auto_select_speaker</code>, <code>a_auto_select_speaker</code> (group chat)</td> </tr> </tbody> </table> <h2 id=semantic-attributes>Semantic Attributes<a class=headerlink href=#semantic-attributes title="Permanent link">#</a></h2> <p>AG2 spans carry both standard OpenTelemetry GenAI attributes and AG2-specific attributes.</p> <h3 id=standard-opentelemetry-genai-attributes>Standard OpenTelemetry GenAI Attributes<a class=headerlink href=#standard-opentelemetry-genai-attributes title="Permanent link">#</a></h3> <p>These follow the <a href=https://opentelemetry.io/docs/specs/semconv/gen-ai/ classname=external-link target=_blank rel="noopener noreferrer">OpenTelemetry GenAI Semantic Conventions</a>:</p> <table> <thead> <tr> <th>Attribute</th> <th>Type</th> <th>Description</th> <th>Span types</th> </tr> </thead> <tbody> <tr> <td><code>gen_ai.operation.name</code></td> <td>string</td> <td>Operation name (<code>conversation</code>, <code>invoke_agent</code>, <code>chat</code>, etc.)</td> <td>All</td> </tr> <tr> <td><code>gen_ai.agent.name</code></td> <td>string</td> <td>Name of the agent</td> <td><code>conversation</code>, <code>agent</code>, <code>code_execution</code>, <code>human_input</code></td> </tr> <tr> <td><code>gen_ai.provider.name</code></td> <td>string</td> <td>LLM provider (<code>openai</code>, <code>anthropic</code>, <code>azure.ai.openai</code>, etc.)</td> <td><code>conversation</code>, <code>agent</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.request.model</code></td> <td>string</td> <td>Requested model name</td> <td><code>conversation</code>, <code>agent</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.response.model</code></td> <td>string</td> <td>Model name in the response (may differ from request)</td> <td><code>conversation</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.usage.input_tokens</code></td> <td>int</td> <td>Number of input/prompt tokens</td> <td><code>conversation</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.usage.output_tokens</code></td> <td>int</td> <td>Number of output/completion tokens</td> <td><code>conversation</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.usage.cost</code></td> <td>float</td> <td>Total cost of the operation</td> <td><code>conversation</code>, <code>llm</code></td> </tr> <tr> <td><code>gen_ai.request.temperature</code></td> <td>float</td> <td>Temperature parameter</td> <td><code>llm</code></td> </tr> <tr> <td><code>gen_ai.request.max_tokens</code></td> <td>int</td> <td>Max tokens parameter</td> <td><code>llm</code></td> </tr> <tr> <td><code>gen_ai.request.top_p</code></td> <td>float</td> <td>Top-p parameter</td> <td><code>llm</code></td> </tr> <tr> <td><code>gen_ai.input.messages</code></td> <td>string (JSON)</td> <td>Input messages in OTEL format</td> <td><code>conversation</code>, <code>agent</code>, <code>llm</code> (opt-in)</td> </tr> <tr> <td><code>gen_ai.output.messages</code></td> <td>string (JSON)</td> <td>Output messages in OTEL format</td> <td><code>conversation</code>, <code>agent</code>, <code>llm</code> (opt-in)</td> </tr> <tr> <td><code>gen_ai.response.finish_reasons</code></td> <td>string (JSON)</td> <td>Finish reasons from the LLM response</td> <td><code>llm</code></td> </tr> <tr> <td><code>gen_ai.tool.name</code></td> <td>string</td> <td>Tool function name</td> <td><code>tool</code></td> </tr> <tr> <td><code>gen_ai.tool.call.id</code></td> <td>string</td> <td>Tool call ID</td> <td><code>tool</code></td> </tr> <tr> <td><code>gen_ai.tool.call.arguments</code></td> <td>string (JSON)</td> <td>Tool call arguments</td> <td><code>tool</code></td> </tr> <tr> <td><code>gen_ai.tool.call.result</code></td> <td>string</td> <td>Tool call result</td> <td><code>tool</code></td> </tr> <tr> <td><code>gen_ai.conversation.id</code></td> <td>string</td> <td>Conversation/chat ID</td> <td><code>conversation</code></td> </tr> <tr> <td><code>gen_ai.conversation.turns</code></td> <td>int</td> <td>Number of turns in the conversation</td> <td><code>conversation</code></td> </tr> <tr> <td><code>gen_ai.conversation.max_turns</code></td> <td>int</td> <td>Maximum allowed turns</td> <td><code>conversation</code></td> </tr> </tbody> </table> <h3 id=ag2-specific-attributes>AG2-Specific Attributes<a class=headerlink href=#ag2-specific-attributes title="Permanent link">#</a></h3> <table> <thead> <tr> <th>Attribute</th> <th>Type</th> <th>Description</th> <th>Span types</th> </tr> </thead> <tbody> <tr> <td><code>ag2.span.type</code></td> <td>string</td> <td>AG2 span type (see <a href=#span-types>Span Types</a> table)</td> <td>All</td> </tr> <tr> <td><code>ag2.speaker_selection.candidates</code></td> <td>string (JSON)</td> <td>List of candidate agent names</td> <td><code>speaker_selection</code></td> </tr> <tr> <td><code>ag2.speaker_selection.selected</code></td> <td>string</td> <td>Name of the selected speaker</td> <td><code>speaker_selection</code></td> </tr> <tr> <td><code>ag2.human_input.prompt</code></td> <td>string</td> <td>Prompt shown to the human</td> <td><code>human_input</code></td> </tr> <tr> <td><code>ag2.human_input.response</code></td> <td>string</td> <td>Human's response</td> <td><code>human_input</code></td> </tr> <tr> <td><code>ag2.code_execution.exit_code</code></td> <td>int</td> <td>Exit code from code execution</td> <td><code>code_execution</code></td> </tr> <tr> <td><code>ag2.code_execution.output</code></td> <td>string</td> <td>Output from code execution (truncated to 4096 chars)</td> <td><code>code_execution</code></td> </tr> <tr> <td><code>ag2.chats.count</code></td> <td>int</td> <td>Number of chats in <code>initiate_chats</code></td> <td><code>multi_conversation</code></td> </tr> <tr> <td><code>ag2.chats.mode</code></td> <td>string</td> <td><code>"sequential"</code> or <code>"parallel"</code></td> <td><code>multi_conversation</code></td> </tr> <tr> <td><code>ag2.chats.recipients</code></td> <td>string (JSON)</td> <td>List of recipient agent names</td> <td><code>multi_conversation</code></td> </tr> <tr> <td><code>gen_ai.agent.remote</code></td> <td>bool</td> <td>Whether the agent is a remote A2A agent</td> <td><code>agent</code></td> </tr> <tr> <td><code>server.address</code></td> <td>string</td> <td>URL of the remote A2A agent</td> <td><code>agent</code></td> </tr> <tr> <td><code>error.type</code></td> <td>string</td> <td>Error type on failure (<code>ExecutionError</code>, <code>CodeExecutionError</code>, etc.)</td> <td>Any</td> </tr> </tbody> </table> <h2 id=backend-integration>Backend Integration<a class=headerlink href=#backend-integration title="Permanent link">#</a></h2> <h3 id=grafana-tempo>Grafana Tempo<a class=headerlink href=#grafana-tempo title="Permanent link">#</a></h3> <p><a href=https://grafana.com/oss/tempo/ classname=external-link target=_blank rel="noopener noreferrer">Grafana Tempo</a> is an open-source distributed tracing backend that integrates with the Grafana observability stack.</p> <div class=highlight><span class=filename>tempo_setup.py</span><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>trace</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class=w> </span><span class=kn>import</span> <span class=n>OTLPSpanExporter</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.resources</span><span class=w> </span><span class=kn>import</span> <span class=n>Resource</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace</span><span class=w> </span><span class=kn>import</span> <span class=n>TracerProvider</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace.export</span><span class=w> </span><span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span><span class=s2>"service.name"</span><span class=p>:</span> <span class=s2>"my-ag2-service"</span><span class=p>})</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=n>tracer_provider</span> <span class=o>=</span> <span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>)</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=c1># Point to your Tempo/OTel Collector OTLP gRPC endpoint</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>OTLPSpanExporter</span><span class=p>(</span><span class=n>endpoint</span><span class=o>=</span><span class=s2>"http://localhost:4317"</span><span class=p>)</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=n>tracer_provider</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span><span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>exporter</span><span class=p>))</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>tracer_provider</span><span class=p>)</span>
</code></pre></div> <h3 id=jaeger>Jaeger<a class=headerlink href=#jaeger title="Permanent link">#</a></h3> <p><a href=https://www.jaegertracing.io/ classname=external-link target=_blank rel="noopener noreferrer">Jaeger</a> natively supports OTLP ingestion, so the setup is the same:</p> <div class=highlight><span class=filename>jaeger_setup.py</span><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class=w> </span><span class=kn>import</span> <span class=n>OTLPSpanExporter</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=c1># Jaeger's OTLP gRPC endpoint (default port 4317)</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>OTLPSpanExporter</span><span class=p>(</span><span class=n>endpoint</span><span class=o>=</span><span class=s2>"http://localhost:4317"</span><span class=p>)</span>
</code></pre></div> <h3 id=commercial-backends>Commercial Backends<a class=headerlink href=#commercial-backends title="Permanent link">#</a></h3> <p>Most commercial observability platforms accept OTLP traces. Typically you only need to change the <code>endpoint</code> and add authentication headers:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>OTLPSpanExporter</span><span class=p>(</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=n>endpoint</span><span class=o>=</span><span class=s2>"https://otel.vendor.com:4317"</span><span class=p>,</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s2>"api-key"</span><span class=p>:</span> <span class=s2>"YOUR_API_KEY"</span><span class=p>},</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=p>)</span>
</code></pre></div> <p>Consult your vendor's documentation for the exact endpoint and authentication details. Popular options include <a href=https://docs.datadoghq.com/opentelemetry/ classname=external-link target=_blank rel="noopener noreferrer">Datadog</a>, <a href=https://docs.honeycomb.io/send-data/opentelemetry/ classname=external-link target=_blank rel="noopener noreferrer">Honeycomb</a>, and <a href=https://grafana.com/products/cloud/ classname=external-link target=_blank rel="noopener noreferrer">Grafana Cloud</a>.</p> <h2 id=local-development-stack>Local Development Stack<a class=headerlink href=#local-development-stack title="Permanent link">#</a></h2> <p>For local development and testing, you can run an OpenTelemetry Collector, Grafana Tempo, and Grafana using Docker Compose. See the <a href=../local-setup/ >Local OpenTelemetry Setup</a> page for the full configuration files and instructions.</p> <p>Once the stack is running, point your exporter at the collector:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>OTLPSpanExporter</span><span class=p>(</span><span class=n>endpoint</span><span class=o>=</span><span class=s2>"http://localhost:14317"</span><span class=p>)</span>
</code></pre></div> <p>Then open <a href=http://localhost:3333 classname=external-link target=_blank rel="noopener noreferrer">http://localhost:3333</a> in your browser to explore traces in Grafana.</p> <h2 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">#</a></h2> <h3 id=two-agent-chat>Two-Agent Chat<a class=headerlink href=#two-agent-chat title="Permanent link">#</a></h3> <p>A basic code-review workflow between a reviewer and a coder, with full tracing of the conversation, each agent turn, and every LLM call:</p> <div class=highlight><span class=filename>two_agent_tracing.py</span><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>trace</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class=w> </span><span class=kn>import</span> <span class=n>OTLPSpanExporter</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.resources</span><span class=w> </span><span class=kn>import</span> <span class=n>Resource</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace</span><span class=w> </span><span class=kn>import</span> <span class=n>TracerProvider</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace.export</span><span class=w> </span><span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_agent</span><span class=p>,</span> <span class=n>instrument_llm_wrapper</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=c1># Setup tracing</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span><span class=s2>"service.name"</span><span class=p>:</span> <span class=s2>"two-agent-chat"</span><span class=p>})</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=n>tracer_provider</span> <span class=o>=</span> <span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>)</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=n>exporter</span> <span class=o>=</span> <span class=n>OTLPSpanExporter</span><span class=p>(</span><span class=n>endpoint</span><span class=o>=</span><span class=s2>"http://localhost:14317"</span><span class=p>)</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=n>tracer_provider</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span><span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>exporter</span><span class=p>))</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=n>reviewer</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"reviewer"</span><span class=p>,</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You are a code reviewer. Provide constructive feedback."</span><span class=p>,</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=p>)</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=n>coder</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"coder"</span><span class=p>,</span>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You are an expert Python developer."</span><span class=p>,</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a>    <span class=n>is_termination_msg</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=s2>"LGTM"</span> <span class=ow>in</span> <span class=n>x</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"content"</span><span class=p>,</span> <span class=s2>""</span><span class=p>),</span>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=p>)</span>
<a id=__codelineno-16-33 name=__codelineno-16-33 href=#__codelineno-16-33></a>
<a id=__codelineno-16-34 name=__codelineno-16-34 href=#__codelineno-16-34></a><span class=c1># Instrument</span>
<a id=__codelineno-16-35 name=__codelineno-16-35 href=#__codelineno-16-35></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-16-36 name=__codelineno-16-36 href=#__codelineno-16-36></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>reviewer</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-16-37 name=__codelineno-16-37 href=#__codelineno-16-37></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>coder</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-16-38 name=__codelineno-16-38 href=#__codelineno-16-38></a>
<a id=__codelineno-16-39 name=__codelineno-16-39 href=#__codelineno-16-39></a><span class=n>result</span> <span class=o>=</span> <span class=n>reviewer</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-16-40 name=__codelineno-16-40 href=#__codelineno-16-40></a>    <span class=n>coder</span><span class=p>,</span>
<a id=__codelineno-16-41 name=__codelineno-16-41 href=#__codelineno-16-41></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Write a Python function to compute the Fibonacci sequence."</span><span class=p>,</span>
<a id=__codelineno-16-42 name=__codelineno-16-42 href=#__codelineno-16-42></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-16-43 name=__codelineno-16-43 href=#__codelineno-16-43></a><span class=p>)</span>
<a id=__codelineno-16-44 name=__codelineno-16-44 href=#__codelineno-16-44></a><span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <h3 id=tool-execution>Tool Execution<a class=headerlink href=#tool-execution title="Permanent link">#</a></h3> <p>Tool calls produce <code>execute_tool</code> spans nested inside the agent's <code>invoke_agent</code> span:</p> <div class=highlight><span class=filename>tool_tracing.py</span><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=kn>from</span><span class=w> </span><span class=nn>typing</span><span class=w> </span><span class=kn>import</span> <span class=n>Annotated</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>trace</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class=w> </span><span class=kn>import</span> <span class=n>OTLPSpanExporter</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.resources</span><span class=w> </span><span class=kn>import</span> <span class=n>Resource</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace</span><span class=w> </span><span class=kn>import</span> <span class=n>TracerProvider</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=kn>from</span><span class=w> </span><span class=nn>opentelemetry.sdk.trace.export</span><span class=w> </span><span class=kn>import</span> <span class=n>BatchSpanProcessor</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_agent</span><span class=p>,</span> <span class=n>instrument_llm_wrapper</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.tools</span><span class=w> </span><span class=kn>import</span> <span class=n>tool</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=c1># Setup tracing</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=n>resource</span> <span class=o>=</span> <span class=n>Resource</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>attributes</span><span class=o>=</span><span class=p>{</span><span class=s2>"service.name"</span><span class=p>:</span> <span class=s2>"tool-tracing"</span><span class=p>})</span>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=n>tracer_provider</span> <span class=o>=</span> <span class=n>TracerProvider</span><span class=p>(</span><span class=n>resource</span><span class=o>=</span><span class=n>resource</span><span class=p>)</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=n>tracer_provider</span><span class=o>.</span><span class=n>add_span_processor</span><span class=p>(</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>    <span class=n>BatchSpanProcessor</span><span class=p>(</span><span class=n>OTLPSpanExporter</span><span class=p>(</span><span class=n>endpoint</span><span class=o>=</span><span class=s2>"http://localhost:14317"</span><span class=p>))</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=p>)</span>
<a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=n>trace</span><span class=o>.</span><span class=n>set_tracer_provider</span><span class=p>(</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>
<a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=nd>@tool</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>"Get weather information for a city"</span><span class=p>)</span>
<a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=k>def</span><span class=w> </span><span class=nf>get_weather</span><span class=p>(</span><span class=n>city</span><span class=p>:</span> <span class=n>Annotated</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=s2>"The city name"</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>    </span><span class=sd>"""Get weather information for a city."""</span>
<a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>    <span class=n>weather_data</span> <span class=o>=</span> <span class=p>{</span>
<a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a>        <span class=s2>"new york"</span><span class=p>:</span> <span class=s2>"Sunny, 72F"</span><span class=p>,</span>
<a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>        <span class=s2>"london"</span><span class=p>:</span> <span class=s2>"Cloudy, 15C"</span><span class=p>,</span>
<a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a>        <span class=s2>"tokyo"</span><span class=p>:</span> <span class=s2>"Rainy, 18C"</span><span class=p>,</span>
<a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a>    <span class=p>}</span>
<a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a>    <span class=k>return</span> <span class=n>weather_data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>city</span><span class=o>.</span><span class=n>lower</span><span class=p>(),</span> <span class=sa>f</span><span class=s2>"Weather data not available for </span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
<a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a>
<a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a>
<a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=n>weather_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"weather"</span><span class=p>,</span>
<a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"Use the get_weather tool to answer weather questions."</span><span class=p>,</span>
<a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a>    <span class=n>functions</span><span class=o>=</span><span class=p>[</span><span class=n>get_weather</span><span class=p>],</span>
<a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=p>)</span>
<a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a>
<a id=__codelineno-17-41 name=__codelineno-17-41 href=#__codelineno-17-41></a><span class=c1># Instrument</span>
<a id=__codelineno-17-42 name=__codelineno-17-42 href=#__codelineno-17-42></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-17-43 name=__codelineno-17-43 href=#__codelineno-17-43></a><span class=n>instrument_agent</span><span class=p>(</span><span class=n>weather_agent</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-17-44 name=__codelineno-17-44 href=#__codelineno-17-44></a>
<a id=__codelineno-17-45 name=__codelineno-17-45 href=#__codelineno-17-45></a><span class=n>result</span> <span class=o>=</span> <span class=n>weather_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s2>"What is the weather in Tokyo?"</span><span class=p>,</span> <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-17-46 name=__codelineno-17-46 href=#__codelineno-17-46></a><span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <h3 id=group-chat-with-pattern>Group Chat with Pattern<a class=headerlink href=#group-chat-with-pattern title="Permanent link">#</a></h3> <p>Use <code>instrument_pattern</code> instead of instrumenting each agent individually:</p> <div class=highlight><span class=filename>group_chat_tracing.py</span><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>run_group_chat</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_llm_wrapper</span><span class=p>,</span> <span class=n>instrument_pattern</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=n>researcher</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"researcher"</span><span class=p>,</span>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You research topics and provide factual information."</span><span class=p>,</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=p>)</span>
<a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>
<a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=n>writer</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"writer"</span><span class=p>,</span>
<a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You write clear summaries. Say TERMINATE after being asked to summarize."</span><span class=p>,</span>
<a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>    <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span>
<a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=p>)</span>
<a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>
<a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=n>user</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>"user"</span><span class=p>,</span> <span class=n>human_input_mode</span><span class=o>=</span><span class=s2>"NEVER"</span><span class=p>,</span> <span class=n>llm_config</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>default_auto_reply</span><span class=o>=</span><span class=s2>"Great, summarize for me."</span><span class=p>)</span>
<a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a>
<a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>researcher</span><span class=p>,</span>
<a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>researcher</span><span class=p>,</span> <span class=n>writer</span><span class=p>],</span>
<a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a>    <span class=n>user_agent</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
<a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a>    <span class=n>group_manager_args</span><span class=o>=</span><span class=p>{</span><span class=s2>"llm_config"</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a><span class=p>)</span>
<a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a>
<a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a><span class=c1># Instrument everything in one call</span>
<a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=n>instrument_pattern</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-18-34 name=__codelineno-18-34 href=#__codelineno-18-34></a>
<a id=__codelineno-18-35 name=__codelineno-18-35 href=#__codelineno-18-35></a><span class=n>result</span> <span class=o>=</span> <span class=n>run_group_chat</span><span class=p>(</span>
<a id=__codelineno-18-36 name=__codelineno-18-36 href=#__codelineno-18-36></a>    <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-18-37 name=__codelineno-18-37 href=#__codelineno-18-37></a>    <span class=n>messages</span><span class=o>=</span><span class=s2>"Explain quantum computing in simple terms."</span><span class=p>,</span>
<a id=__codelineno-18-38 name=__codelineno-18-38 href=#__codelineno-18-38></a>    <span class=n>max_rounds</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-18-39 name=__codelineno-18-39 href=#__codelineno-18-39></a><span class=p>)</span>
<a id=__codelineno-18-40 name=__codelineno-18-40 href=#__codelineno-18-40></a><span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <h3 id=distributed-tracing-with-a2a>Distributed Tracing with A2A<a class=headerlink href=#distributed-tracing-with-a2a title="Permanent link">#</a></h3> <p>For multi-service architectures where some agents run as separate A2A servers, instrument both sides to get a single end-to-end trace:</p> <p><strong>Remote agent server:</strong></p> <div class=highlight><span class=filename>remote_server.py</span><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.a2a</span><span class=w> </span><span class=kn>import</span> <span class=n>A2aAgentServer</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_a2a_server</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=n>tech_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"tech_agent"</span><span class=p>,</span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"You solve technical problems."</span><span class=p>,</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=p>)</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=n>server</span> <span class=o>=</span> <span class=n>A2aAgentServer</span><span class=p>(</span><span class=n>tech_agent</span><span class=p>,</span> <span class=n>url</span><span class=o>=</span><span class=s2>"http://localhost:18123/"</span><span class=p>)</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=n>server</span> <span class=o>=</span> <span class=n>instrument_a2a_server</span><span class=p>(</span><span class=n>server</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=n>app</span> <span class=o>=</span> <span class=n>server</span><span class=o>.</span><span class=n>build</span><span class=p>()</span>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=c1># Run with: uvicorn remote_server:app --port 18123</span>
</code></pre></div> <p><strong>Client with remote agent in a group chat:</strong></p> <div class=highlight><span class=filename>client_group_chat.py</span><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=kn>import</span><span class=w> </span><span class=nn>asyncio</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.a2a</span><span class=w> </span><span class=kn>import</span> <span class=n>A2aRemoteAgent</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat</span><span class=w> </span><span class=kn>import</span> <span class=n>a_run_group_chat</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.agentchat.group.patterns</span><span class=w> </span><span class=kn>import</span> <span class=n>AutoPattern</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.opentelemetry</span><span class=w> </span><span class=kn>import</span> <span class=n>instrument_pattern</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>({</span><span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-4o-mini"</span><span class=p>})</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=n>triage_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"triage_agent"</span><span class=p>,</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"Route technical issues to the tech agent."</span><span class=p>,</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=p>)</span>
<a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>
<a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=c1># Remote agent -- calls are traced across the network</span>
<a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=n>tech_agent</span> <span class=o>=</span> <span class=n>A2aRemoteAgent</span><span class=p>(</span>
<a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>    <span class=s2>"http://localhost:18123/"</span><span class=p>,</span>
<a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"tech_agent"</span><span class=p>,</span>
<a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=p>)</span>
<a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a>
<a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=n>pattern</span> <span class=o>=</span> <span class=n>AutoPattern</span><span class=p>(</span>
<a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a>    <span class=n>initial_agent</span><span class=o>=</span><span class=n>triage_agent</span><span class=p>,</span>
<a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a>    <span class=n>agents</span><span class=o>=</span><span class=p>[</span><span class=n>triage_agent</span><span class=p>,</span> <span class=n>tech_agent</span><span class=p>],</span>
<a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a>    <span class=n>group_manager_args</span><span class=o>=</span><span class=p>{</span><span class=s2>"llm_config"</span><span class=p>:</span> <span class=n>llm_config</span><span class=p>},</span>
<a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=p>)</span>
<a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a>
<a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=n>instrument_pattern</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>)</span>
<a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a>
<a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>():</span>
<a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a>    <span class=n>result</span> <span class=o>=</span> <span class=k>await</span> <span class=n>a_run_group_chat</span><span class=p>(</span>
<a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a>        <span class=n>pattern</span><span class=o>=</span><span class=n>pattern</span><span class=p>,</span>
<a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a>        <span class=n>messages</span><span class=o>=</span><span class=s2>"My application crashes on startup with a segfault."</span><span class=p>,</span>
<a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a>        <span class=n>max_rounds</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
<a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a>    <span class=p>)</span>
<a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a>    <span class=k>await</span> <span class=n>result</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a>
<a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>main</span><span class=p>())</span>
</code></pre></div> <p>The <code>instrument_pattern</code> call on the client side instruments <code>A2aRemoteAgent</code> so that W3C <code>traceparent</code> headers are injected into outgoing HTTP requests. The <code>instrument_a2a_server</code> call on the server side extracts those headers, linking the server-side spans to the client trace.</p> <h2 id=message-and-data-capture>Message and Data Capture<a class=headerlink href=#message-and-data-capture title="Permanent link">#</a></h2> <p>AG2 tracing captures data at different levels depending on the span type:</p> <table> <thead> <tr> <th>Span type</th> <th>Data captured</th> <th>Controllable?</th> </tr> </thead> <tbody> <tr> <td><code>conversation</code> (run / initiate_chat)</td> <td>Input/output messages</td> <td>No, always captured</td> </tr> <tr> <td><code>agent</code> (generate_reply)</td> <td>Input/output messages</td> <td>No, always captured</td> </tr> <tr> <td><code>tool</code> (execute_function)</td> <td>Tool arguments and results</td> <td>No, always captured</td> </tr> <tr> <td><code>human_input</code> (get_human_input)</td> <td>Prompt shown and human's response</td> <td>No, always captured</td> </tr> <tr> <td><code>llm</code> (LLM API call)</td> <td>Request/response messages</td> <td>Yes, off by default via <code>capture_messages</code></td> </tr> </tbody> </table> <p>Conversation and agent spans always include input and output messages (<code>gen_ai.input.messages</code> / <code>gen_ai.output.messages</code>). Tool spans always capture call arguments (<code>gen_ai.tool.call.arguments</code>) and results (<code>gen_ai.tool.call.result</code>). Human input spans always capture the prompt shown (<code>ag2.human_input.prompt</code>) and the human's response (<code>ag2.human_input.response</code>). Only LLM spans require explicit opt-in via <code>capture_messages=True</code> -- all other span types capture their data by default.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>If your agents process sensitive data (personal information, credentials, proprietary content), be aware that conversation messages, tool arguments and results, and human input prompts and responses will appear in your tracing backend with default settings. Ensure your backend has appropriate access controls and retention policies.</p> </div> <h3 id=enabling-llm-message-capture>Enabling LLM Message Capture<a class=headerlink href=#enabling-llm-message-capture title="Permanent link">#</a></h3> <p>By default, <code>instrument_llm_wrapper</code> does <strong>not</strong> capture request and response messages on LLM spans. To enable this for debugging or development:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>instrument_llm_wrapper</span><span class=p>(</span><span class=n>tracer_provider</span><span class=o>=</span><span class=n>tracer_provider</span><span class=p>,</span> <span class=n>capture_messages</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <p>When enabled, two additional attributes appear on <code>chat</code> (LLM) spans:</p> <ul> <li><code>gen_ai.input.messages</code> -- JSON array of input messages in OpenTelemetry GenAI format</li> <li><code>gen_ai.output.messages</code> -- JSON array of output messages in OpenTelemetry GenAI format</li> </ul> <p>This includes the full request and response payloads sent to and received from the LLM provider, which can be large and may duplicate content already present on the parent agent span.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 22, 2026 13:18:51 UTC"><span class=timeago datetime=2026-02-22T13:18:51+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 22, 2026 13:18:51 UTC">2026-02-22</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../observability/logging_events/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Logging"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Logging </div> </div> </a> <a href=../remote-agents/ class="md-footer__link md-footer__link--next" aria-label="Next: Tracing Remote Agents"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Tracing Remote Agents </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight>  2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"></path></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"></path></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../../../js/timeago.min.js></script> <script src=../../../../js/timeago_mkdocs_material.js></script> <script src=../../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>